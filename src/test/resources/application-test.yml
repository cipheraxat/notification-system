# =====================================================
# Test Configuration - application-test.yml
# =====================================================
# 
# This configuration is used when running tests.
# It overrides the main application.yml settings.
# Requires PostgreSQL to be running (via docker-compose).
#

spring:
  # Use PostgreSQL for tests (same as production)
  datasource:
    url: jdbc:postgresql://localhost:5432/notification_db
    driver-class-name: org.postgresql.Driver
    username: postgres
    password: postgres
  
  # JPA settings for tests
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: validate
    show-sql: false
  
  # Enable Flyway to manage schema
  flyway:
    enabled: true
    locations: classpath:db/migration
  
  # Redis - use embedded or mock in tests
  data:
    redis:
      host: localhost
      port: 6379
  
  # Kafka - disable for unit tests
  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      auto-offset-reset: earliest
      group-id: test-group

# Disable scheduled tasks during tests
notification:
  rate-limit:
    email: 10
    sms: 5
    push: 20
    in-app: 100
  retry:
    check-interval-ms: 9999999  # Effectively disable
    stuck-check-interval-ms: 9999999
  dedupe:
    ttl-seconds: 3600  # Shorter TTL for tests (1 hour)
  kafka:
    topic: test-notifications

# Reduce logging noise during tests
logging:
  level:
    root: WARN
    com.notification: INFO
    org.springframework: WARN
