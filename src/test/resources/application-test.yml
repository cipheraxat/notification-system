# =====================================================
# Test Configuration - application-test.yml
# =====================================================
# 
# This configuration is used when running tests.
# It overrides the main application.yml settings.
#

spring:
  # Use H2 in-memory database for tests
  # (no need to run PostgreSQL for unit tests)
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;MODE=PostgreSQL
    driver-class-name: org.h2.Driver
    username: sa
    password: ""
  
  # JPA settings for tests
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: create-drop  # Create schema at start, drop at end
    show-sql: false
  
  # Disable Flyway for tests (use Hibernate auto DDL)
  flyway:
    enabled: false
  
  # Redis - use embedded or mock in tests
  data:
    redis:
      host: localhost
      port: 6379
  
  # Kafka - disable for unit tests
  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      auto-offset-reset: earliest
      group-id: test-group

# Disable scheduled tasks during tests
notification:
  rate-limit:
    email: 10
    sms: 5
    push: 20
    in-app: 100
  retry:
    check-interval-ms: 9999999  # Effectively disable
    stuck-check-interval-ms: 9999999
  kafka:
    topic: test-notifications

# Reduce logging noise during tests
logging:
  level:
    root: WARN
    com.notification: INFO
    org.springframework: WARN
