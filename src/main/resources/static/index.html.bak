<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification System - Data Flow Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #eee;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 30px;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            opacity: 0.8;
            font-size: 1.1em;
        }

        /* Data Flow Pipeline */
        .pipeline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            overflow-x: auto;
        }

        .pipeline-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            min-width: 120px;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 10px;
        }

        .pipeline-step:hover {
            background: rgba(255,255,255,0.1);
        }

        .pipeline-step.active {
            background: rgba(102, 126, 234, 0.3);
            border: 2px solid #667eea;
        }

        .pipeline-step.completed {
            background: rgba(39, 174, 96, 0.3);
        }

        .pipeline-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .pipeline-label {
            font-size: 0.85em;
            text-align: center;
            font-weight: 600;
        }

        .pipeline-arrow {
            font-size: 1.5em;
            color: #667eea;
            margin: 0 5px;
        }

        /* Main Content Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 1000px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: rgba(255,255,255,0.08);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .card h2 {
            font-size: 1.4em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2 .step-num {
            background: #667eea;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.7em;
        }

        .card h3 {
            font-size: 1.1em;
            margin: 15px 0 10px 0;
            color: #a0a0a0;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #ccc;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            font-size: 1em;
            background: rgba(0,0,0,0.3);
            color: #fff;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* Buttons */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.85em;
        }

        /* Response/Output Areas */
        .output-area {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .output-area h4 {
            margin-bottom: 10px;
            color: #a0a0a0;
            font-size: 0.9em;
            text-transform: uppercase;
        }

        .json-output {
            background: #0d1117;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 0.85em;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
            color: #7ee787;
        }

        /* Flow Log */
        .flow-log {
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            font-size: 0.9em;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .log-entry.step1 { background: rgba(52, 152, 219, 0.2); border-left: 3px solid #3498db; }
        .log-entry.step2 { background: rgba(155, 89, 182, 0.2); border-left: 3px solid #9b59b6; }
        .log-entry.step3 { background: rgba(46, 204, 113, 0.2); border-left: 3px solid #2ecc71; }
        .log-entry.step4 { background: rgba(241, 196, 15, 0.2); border-left: 3px solid #f1c40f; }
        .log-entry.step5 { background: rgba(230, 126, 34, 0.2); border-left: 3px solid #e67e22; }
        .log-entry.step6 { background: rgba(231, 76, 60, 0.2); border-left: 3px solid #e74c3c; }
        .log-entry.step7 { background: rgba(26, 188, 156, 0.2); border-left: 3px solid #1abc9c; }
        .log-entry.success { background: rgba(39, 174, 96, 0.3); border-left: 3px solid #27ae60; }
        .log-entry.error { background: rgba(231, 76, 60, 0.3); border-left: 3px solid #e74c3c; }

        .log-icon { font-size: 1.2em; }
        .log-time { color: #888; font-size: 0.8em; }
        .log-message { flex: 1; }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending { background: #f39c12; color: #000; }
        .status-processing { background: #3498db; color: #fff; }
        .status-sent { background: #27ae60; color: #fff; }
        .status-delivered { background: #2ecc71; color: #fff; }
        .status-failed { background: #e74c3c; color: #fff; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 8px;
            color: #ccc;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Template Variables */
        .var-container {
            margin-top: 10px;
        }

        .var-row {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
            align-items: center;
        }

        .var-row input {
            flex: 1;
        }

        .var-row .remove-btn {
            background: #e74c3c;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden { display: none !important; }

        /* Health Status */
        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .health-item {
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            text-align: center;
        }

        .health-item .icon { font-size: 2em; margin-bottom: 10px; }
        .health-item .label { color: #888; font-size: 0.9em; }
        .health-item .status { font-weight: 600; margin-top: 5px; }
        .health-item.up { border: 2px solid #27ae60; }
        .health-item.down { border: 2px solid #e74c3c; }

        /* Full Width Card */
        .full-width { grid-column: 1 / -1; }

        /* Notification History List */
        .notification-list {
            margin-top: 15px;
        }

        .notification-item {
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .notification-item .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .notification-item .channel-icon {
            font-size: 1.2em;
            margin-right: 10px;
        }

        .notification-item .content-preview {
            color: #aaa;
            font-size: 0.9em;
        }

        /* Notifications Monitor */
        .notifications-list {
            max-height: 600px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .notification-card {
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .notification-card .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .notification-card .channel-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .notification-card .channel-badge.EMAIL { background: #3498db; color: white; }
        .notification-card .channel-badge.SMS { background: #27ae60; color: white; }
        .notification-card .channel-badge.PUSH { background: #e67e22; color: white; }
        .notification-card .channel-badge.IN_APP { background: #9b59b6; color: white; }

        .notification-card .status-badge {
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .notification-card .status-badge.PENDING { background: #f39c12; color: white; }
        .notification-card .status-badge.SENT { background: #27ae60; color: white; }
        .notification-card .status-badge.FAILED { background: #e74c3c; color: white; }

        .notification-card .content {
            color: #eee;
            margin: 10px 0;
        }

        .notification-card .meta {
            display: flex;
            gap: 15px;
            font-size: 0.85em;
            color: #aaa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîî Notification System</h1>
            <p>Data Flow Tester - Trace Your Notifications Step by Step</p>
        </div>

        <!-- Data Flow Pipeline Visualization -->
        <div class="pipeline" id="pipelineVisualization">
            <div class="pipeline-step" data-step="1" onclick="scrollToSection('step1')">
                <div class="pipeline-icon">üì®</div>
                <div class="pipeline-label">HTTP Request</div>
            </div>
            <div class="pipeline-arrow">‚Üí</div>
            <div class="pipeline-step" data-step="2" onclick="scrollToSection('step2')">
                <div class="pipeline-icon">‚öôÔ∏è</div>
                <div class="pipeline-label">Service Layer</div>
            </div>
            <div class="pipeline-arrow">‚Üí</div>
            <div class="pipeline-step" data-step="3" onclick="scrollToSection('step3')">
                <div class="pipeline-icon">üìã</div>
                <div class="pipeline-label">Kafka Queue</div>
            </div>
            <div class="pipeline-arrow">‚Üí</div>
            <div class="pipeline-step" data-step="4" onclick="scrollToSection('step4')">
                <div class="pipeline-icon">üéß</div>
                <div class="pipeline-label">Consumer</div>
            </div>
            <div class="pipeline-arrow">‚Üí</div>
            <div class="pipeline-step" data-step="5" onclick="scrollToSection('step5')">
                <div class="pipeline-icon">üîÄ</div>
                <div class="pipeline-label">Dispatcher</div>
            </div>
            <div class="pipeline-arrow">‚Üí</div>
            <div class="pipeline-step" data-step="6" onclick="scrollToSection('step6')">
                <div class="pipeline-icon">üì§</div>
                <div class="pipeline-label">Channel Handler</div>
            </div>
            <div class="pipeline-arrow">‚Üí</div>
            <div class="pipeline-step" data-step="7" onclick="scrollToSection('step7')">
                <div class="pipeline-icon">‚úÖ</div>
                <div class="pipeline-label">Delivered</div>
            </div>
            <div class="pipeline-arrow">‚Üí</div>
            <div class="pipeline-step" data-step="8" onclick="scrollToSection('notificationsMonitor')">
                <div class="pipeline-icon">üìä</div>
                <div class="pipeline-label">Monitor</div>
            </div>
        </div>

        <div class="main-grid">
            <!-- STEP 1: HTTP Request (Send Notification) -->
            <div class="card" id="step1">
                <h2><span class="step-num">STEP 1</span> üì® HTTP Request - Send Notification</h2>
                <p style="color: #888; margin-bottom: 15px;">POST /api/v1/notifications</p>

                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('directContent', this)">Direct Content</button>
                    <button class="tab-btn" onclick="showTab('useTemplate', this)">Use Template</button>
                </div>

                <div id="directContent" class="tab-content active">
                    <div class="form-group">
                        <label>User ID</label>
                        <input type="text" id="userId" placeholder="550e8400-e29b-41d4-a716-446655440001" value="550e8400-e29b-41d4-a716-446655440001">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Channel</label>
                            <select id="channel">
                                <option value="EMAIL">üìß Email</option>
                                <option value="SMS">üì± SMS</option>
                                <option value="PUSH">üîî Push</option>
                                <option value="IN_APP">üì¨ In-App</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select id="priority">
                                <option value="LOW">Low</option>
                                <option value="MEDIUM" selected>Medium</option>
                                <option value="HIGH">High</option>
                                <option value="CRITICAL">Critical</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Subject</label>
                        <input type="text" id="subject" placeholder="Welcome to our platform!">
                    </div>

                    <div class="form-group">
                        <label>Content</label>
                        <textarea id="content" placeholder="Your notification message here...">Hello! This is a test notification from the data flow tester.</textarea>
                    </div>

                    <div class="form-group">
                        <label>Event ID (for deduplication - optional)</label>
                        <input type="text" id="eventId" placeholder="order-123-confirmation">
                    </div>
                </div>

                <div id="useTemplate" class="tab-content">
                    <div class="form-group">
                        <label>User ID</label>
                        <input type="text" id="templateUserId" placeholder="550e8400-e29b-41d4-a716-446655440001" value="550e8400-e29b-41d4-a716-446655440001">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Channel</label>
                            <select id="templateChannel">
                                <option value="EMAIL">üìß Email</option>
                                <option value="SMS">üì± SMS</option>
                                <option value="PUSH">üîî Push</option>
                                <option value="IN_APP">üì¨ In-App</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select id="templatePriority">
                                <option value="MEDIUM" selected>Medium</option>
                                <option value="HIGH">High</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Template Name</label>
                        <input type="text" id="templateName" placeholder="welcome-email">
                    </div>

                    <div class="form-group">
                        <label>Template Variables</label>
                        <div class="var-container" id="templateVars">
                            <div class="var-row">
                                <input type="text" placeholder="Variable name" value="userName">
                                <input type="text" placeholder="Value" value="John Doe">
                                <button class="remove-btn" onclick="removeVarRow(this)">√ó</button>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-info" onclick="addVarRow()">+ Add Variable</button>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="sendNotification()">
                    üöÄ Send Notification
                </button>
                <button class="btn btn-warning" onclick="sendBulkNotification()">
                    üì¶ Send Bulk
                </button>

                <div id="requestOutput" class="output-area hidden">
                    <h4>üì§ Request Sent</h4>
                    <div class="json-output" id="requestJson"></div>
                </div>
            </div>

            <!-- STEP 2-3: Service Layer & Kafka -->
            <div class="card" id="step2">
                <h2><span class="step-num">STEP 2-3</span> ‚öôÔ∏è Service Layer Processing</h2>
                <p style="color: #888; margin-bottom: 15px;">Validation ‚Üí Rate Limit ‚Üí Template ‚Üí DB Save ‚Üí Kafka</p>

                <div class="flow-log" id="flowLog">
                    <div class="log-entry step1">
                        <span class="log-icon">‚è≥</span>
                        <span class="log-message">Waiting for notification request...</span>
                    </div>
                </div>

                <div id="responseOutput" class="output-area hidden">
                    <h4>üì• API Response (201 Created)</h4>
                    <div class="json-output" id="responseJson"></div>
                </div>
            </div>

            <!-- STEP 4-6: Async Processing -->
            <div class="card" id="step4">
                <h2><span class="step-num">STEP 4-6</span> üéß Async Processing (Kafka Consumer)</h2>
                <p style="color: #888; margin-bottom: 15px;">Consumer picks up ‚Üí Dispatcher routes ‚Üí Handler delivers</p>

                <div class="form-group">
                    <label>Track Notification by ID</label>
                    <input type="text" id="trackNotificationId" placeholder="Notification ID from response">
                </div>
                <button class="btn btn-info" onclick="trackNotification()">üîç Track Status</button>
                <button class="btn btn-success" onclick="refreshNotificationStatus()">üîÑ Refresh</button>

                <div id="trackingOutput" class="output-area hidden">
                    <h4>üìä Notification Status</h4>
                    <div class="json-output" id="trackingJson"></div>
                </div>
            </div>

            <!-- STEP 7: User Inbox / History -->
            <div class="card" id="step7">
                <h2><span class="step-num">STEP 7</span> ‚úÖ Delivery Confirmation & User Inbox</h2>
                <p style="color: #888; margin-bottom: 15px;">View delivered notifications & manage read status</p>

                <div class="form-group">
                    <label>User ID</label>
                    <input type="text" id="inboxUserId" value="550e8400-e29b-41d4-a716-446655440001">
                </div>

                <button class="btn btn-primary" onclick="getUserInbox()">üì¨ Get Inbox</button>
                <button class="btn btn-info" onclick="getUnreadCount()">üî¢ Unread Count</button>
                <button class="btn btn-warning" onclick="markAllRead()">‚úì Mark All Read</button>

                <div id="inboxOutput" class="output-area hidden">
                    <div id="inboxContent"></div>
                </div>
            </div>

            <!-- Template Management -->
            <div class="card">
                <h2>üé® Template Management</h2>
                <p style="color: #888; margin-bottom: 15px;">Create templates for {{variable}} substitution</p>

                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('createTemplate', this)">Create</button>
                    <button class="tab-btn" onclick="showTab('listTemplates', this)">List</button>
                </div>

                <div id="createTemplate" class="tab-content active">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Template Name</label>
                            <input type="text" id="newTemplateName" placeholder="welcome-email">
                        </div>
                        <div class="form-group">
                            <label>Channel</label>
                            <select id="newTemplateChannel">
                                <option value="EMAIL">üìß Email</option>
                                <option value="SMS">üì± SMS</option>
                                <option value="PUSH">üîî Push</option>
                                <option value="IN_APP">üì¨ In-App</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Subject Template</label>
                        <input type="text" id="newTemplateSubject" placeholder="Welcome, {{userName}}!">
                    </div>

                    <div class="form-group">
                        <label>Body Template</label>
                        <textarea id="newTemplateBody" placeholder="Hi {{userName}}, click here: {{link}}"></textarea>
                    </div>

                    <button class="btn btn-success" onclick="createTemplate()">Create Template</button>
                </div>

                <div id="listTemplates" class="tab-content">
                    <button class="btn btn-primary" onclick="loadTemplates()">Load All</button>
                    <button class="btn btn-sm btn-info" onclick="loadTemplatesByChannel('EMAIL')">üìß Email</button>
                    <button class="btn btn-sm btn-info" onclick="loadTemplatesByChannel('SMS')">üì± SMS</button>
                    <button class="btn btn-sm btn-info" onclick="loadTemplatesByChannel('PUSH')">üîî Push</button>
                </div>

                <div id="templateOutput" class="output-area hidden">
                    <div class="json-output" id="templateJson"></div>
                </div>
            </div>

            <!-- User Management -->
            <div class="card">
                <h2>üë• User Management</h2>
                <p style="color: #888; margin-bottom: 15px;">Comprehensive user operations for notification testing and management</p>

                <!-- Quick Actions -->
                <div class="form-row">
                    <button class="btn btn-info" onclick="getAllUsers()">üìã List All Users</button>
                    <button class="btn btn-success" onclick="getPushEligibleUsers()">üîî Push-Eligible Users</button>
                    <button class="btn btn-warning" onclick="getUsersWithUnreadNotifications()">üì¨ Users with Unread</button>
                </div>

                <!-- User Lookup Section -->
                <h3 style="margin-top: 20px; margin-bottom: 10px;">üîç User Lookup</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Find by Email</label>
                        <input type="email" id="lookupEmail" placeholder="john@example.com" value="john.doe@example.com">
                    </div>
                    <div class="form-group">
                        <label>Find by Phone</label>
                        <input type="tel" id="lookupPhone" placeholder="+1234567890">
                    </div>
                    <div class="form-group">
                        <label>Find by User ID</label>
                        <input type="text" id="lookupUserId" placeholder="user-123">
                    </div>
                </div>

                <div class="form-row">
                    <button class="btn btn-primary" onclick="findUserByEmail()">üìß Find by Email</button>
                    <button class="btn btn-primary" onclick="findUserByPhone()">üì± Find by Phone</button>
                    <button class="btn btn-primary" onclick="findUserById()">üÜî Find by ID</button>
                </div>

                <!-- User Operations Section -->
                <h3 style="margin-top: 20px; margin-bottom: 10px;">‚öôÔ∏è User Operations</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>User ID for Operations</label>
                        <input type="text" id="operationUserId" placeholder="user-123">
                    </div>
                </div>

                <div class="form-row">
                    <button class="btn btn-info" onclick="getUserNotificationHistory()">üìú Notification History</button>
                    <button class="btn btn-warning" onclick="getUnreadCount()">üî¢ Unread Count</button>
                    <button class="btn btn-success" onclick="markAllAsRead()">‚úÖ Mark All Read</button>
                </div>

                <!-- Update User Section -->
                <h3 style="margin-top: 20px; margin-bottom: 10px;">‚úèÔ∏è Update User</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>User ID *</label>
                        <input type="text" id="updateUserId" placeholder="user-123" required>
                    </div>
                    <div class="form-group">
                        <label>New Email</label>
                        <input type="email" id="updateUserEmail" placeholder="updated@example.com">
                    </div>
                    <div class="form-group">
                        <label>New Phone</label>
                        <input type="tel" id="updateUserPhone" placeholder="+1987654321">
                    </div>
                    <div class="form-group">
                        <label>New Device Token</label>
                        <input type="text" id="updateUserDeviceToken" placeholder="new-firebase-token">
                    </div>
                </div>

                <button class="btn btn-warning" onclick="updateUser()">üîÑ Update User</button>

                <!-- Create User -->
                <h3 style="margin-top: 20px; margin-bottom: 10px;">‚ûï Create New User</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="createUserEmail" placeholder="newuser@example.com" required>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="createUserPhone" placeholder="+1234567890">
                    </div>
                    <div class="form-group">
                        <label>Device Token</label>
                        <input type="text" id="createUserDeviceToken" placeholder="Firebase/APNs token">
                    </div>
                </div>

                <div class="form-row">
                    <button class="btn btn-success" onclick="createUser()">‚ûï Create User</button>
                    <button class="btn btn-danger" onclick="deleteUser()" style="margin-left: 10px;">üóëÔ∏è Delete User</button>
                </div>

                <div id="userOutput" class="output-area hidden">
                    <div class="json-output" id="userJson"></div>
                </div>
            </div>

            <!-- All Topics Notifications Monitor -->
            <div class="card full-width" id="notificationsMonitor">
                <h2>üì° All Topics Notifications Monitor</h2>
                <p style="color: #888; margin-bottom: 15px;">View notifications from all Kafka topics and channels</p>

                <div class="form-row">
                    <button class="btn btn-primary" onclick="loadAllNotifications()">üìã Load All Notifications</button>
                    <button class="btn btn-info" onclick="loadNotificationsByUser()">üë§ Load by User ID</button>
                    <div class="form-group" style="margin-left: 10px;">
                        <input type="text" id="filterUserId" placeholder="User ID (optional)">
                    </div>
                    <button class="btn btn-secondary" onclick="clearNotifications()">üóëÔ∏è Clear</button>
                </div>

                <div id="notificationsMonitorOutput" class="output-area hidden">
                    <div class="notifications-list" id="notificationsList"></div>
                </div>
            </div>

            <!-- Health Check - Full Width -->
            <div class="card full-width">
                <h2>‚ù§Ô∏è System Health - Infrastructure Status</h2>
                <p style="color: #888; margin-bottom: 15px;">Check the status of all system components</p>

                <button class="btn btn-primary" onclick="checkHealth()">üîç Basic Check</button>
                <button class="btn btn-success" onclick="checkDetailedHealth()">üìä Detailed Check</button>

                <div id="healthGrid" class="health-grid hidden">
                    <div class="health-item" id="healthService">
                        <div class="icon">üîî</div>
                        <div class="label">Service</div>
                        <div class="status">-</div>
                    </div>
                    <div class="health-item" id="healthDatabase">
                        <div class="icon">üóÑÔ∏è</div>
                        <div class="label">PostgreSQL</div>
                        <div class="status">-</div>
                    </div>
                    <div class="health-item" id="healthRedis">
                        <div class="icon">‚ö°</div>
                        <div class="label">Redis</div>
                        <div class="status">-</div>
                    </div>
                    <div class="health-item" id="healthKafka">
                        <div class="icon">üìã</div>
                        <div class="label">Kafka</div>
                        <div class="status">-</div>
                    </div>
                </div>

                <div id="healthOutput" class="output-area hidden">
                    <div class="json-output" id="healthJson"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab functionality
        function showTab(tabId, btn) {
            const parent = btn.closest('.card');
            parent.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            parent.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            btn.classList.add('active');
        }

        // Template variables
        function addVarRow() {
            const container = document.getElementById('templateVars');
            const row = document.createElement('div');
            row.className = 'var-row';
            row.innerHTML = `
                <input type="text" placeholder="Variable name">
                <input type="text" placeholder="Value">
                <button class="remove-btn" onclick="removeVarRow(this)">√ó</button>
            `;
            container.appendChild(row);
        }

        function removeVarRow(btn) {
            btn.parentElement.remove();
        }

        // Scroll to section
        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // Update pipeline visualization
        function updatePipeline(step, completed = false) {
            document.querySelectorAll('.pipeline-step').forEach(s => {
                s.classList.remove('active');
                const stepNum = parseInt(s.dataset.step);
                if (stepNum < step) s.classList.add('completed');
            });
            const activeStep = document.querySelector(`.pipeline-step[data-step="${step}"]`);
            if (activeStep) {
                if (completed) {
                    activeStep.classList.add('completed');
                } else {
                    activeStep.classList.add('active');
                }
            }
        }

        // Flow log
        function addLog(step, icon, message, type = '') {
            const log = document.getElementById('flowLog');
            const entry = document.createElement('div');
            entry.className = `log-entry step${step} ${type}`;
            const time = new Date().toLocaleTimeString();
            entry.innerHTML = `
                <span class="log-icon">${icon}</span>
                <span class="log-message">${message}</span>
                <span class="log-time">${time}</span>
            `;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function clearLog() {
            document.getElementById('flowLog').innerHTML = '';
        }

        // JSON formatting
        function formatJson(obj) {
            return JSON.stringify(obj, null, 2);
        }

        function showOutput(elementId, jsonId, data) {
            document.getElementById(elementId).classList.remove('hidden');
            document.getElementById(jsonId).textContent = formatJson(data);
        }

        // ============ STEP 1: Send Notification ============
        async function sendNotification() {
            clearLog();
            updatePipeline(1);
            
            const isTemplate = document.getElementById('useTemplate').classList.contains('active');
            let request;

            if (isTemplate) {
                const vars = {};
                document.querySelectorAll('#templateVars .var-row').forEach(row => {
                    const inputs = row.querySelectorAll('input');
                    if (inputs[0].value && inputs[1].value) {
                        vars[inputs[0].value] = inputs[1].value;
                    }
                });

                request = {
                    userId: document.getElementById('templateUserId').value,
                    channel: document.getElementById('templateChannel').value,
                    priority: document.getElementById('templatePriority').value,
                    templateName: document.getElementById('templateName').value,
                    templateVariables: vars
                };
            } else {
                request = {
                    userId: document.getElementById('userId').value,
                    channel: document.getElementById('channel').value,
                    priority: document.getElementById('priority').value,
                    subject: document.getElementById('subject').value,
                    content: document.getElementById('content').value,
                    eventId: document.getElementById('eventId').value || undefined
                };
            }

            // Show request
            showOutput('requestOutput', 'requestJson', request);
            addLog(1, 'üì®', `HTTP POST /api/v1/notifications`);
            addLog(1, 'üì§', `Request body: ${request.channel} notification to user ${request.userId.substring(0,8)}...`);

            try {
                updatePipeline(2);
                addLog(2, 'üîç', 'Validating user exists...');
                
                const response = await fetch('/api/v1/notifications', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(request)
                });

                const data = await response.json();

                if (response.ok) {
                    addLog(2, '‚úÖ', 'User validation passed');
                    addLog(2, '‚ö°', 'Checking rate limit (Redis)...');
                    addLog(2, '‚úÖ', 'Rate limit OK');
                    
                    if (request.templateName) {
                        addLog(2, 'üìù', `Processing template: ${request.templateName}`);
                    }
                    
                    addLog(2, 'üíæ', 'Saving notification to PostgreSQL...');
                    addLog(2, '‚úÖ', `Notification created: ${data.data?.id?.substring(0,8)}...`);
                    
                    updatePipeline(3);
                    addLog(3, 'üìã', `Sending to Kafka topic: notifications.${request.channel.toLowerCase()}`);
                    addLog(3, '‚úÖ', 'Message queued in Kafka');

                    updatePipeline(4);
                    addLog(4, 'üéß', 'Consumer picking up message (async)...');

                    // Auto-populate tracking field
                    if (data.data?.id) {
                        document.getElementById('trackNotificationId').value = data.data.id;
                    }

                    showOutput('responseOutput', 'responseJson', data);

                    // Simulate async processing
                    setTimeout(() => {
                        updatePipeline(5);
                        addLog(5, 'üîÄ', 'ChannelDispatcher routing to handler...');
                    }, 500);

                    setTimeout(() => {
                        updatePipeline(6);
                        addLog(6, 'üì§', `${request.channel}ChannelHandler.send() called`);
                        addLog(6, 'üìß', `Delivering to: ${request.channel} provider...`);
                    }, 1000);

                    setTimeout(() => {
                        updatePipeline(7, true);
                        addLog(7, '‚úÖ', 'Notification SENT!', 'success');
                        addLog(7, 'üéâ', 'Status updated in database', 'success');
                    }, 1500);

                } else {
                    addLog(2, '‚ùå', `Error: ${data.message}`, 'error');
                    showOutput('responseOutput', 'responseJson', data);
                }

            } catch (error) {
                addLog(1, '‚ùå', `Network error: ${error.message}`, 'error');
            }
        }

        // Bulk Notification
        async function sendBulkNotification() {
            const userIds = prompt('Enter user IDs (comma-separated):');
            if (!userIds) return;

            const request = {
                userIds: userIds.split(',').map(id => id.trim()),
                channel: document.getElementById('channel').value,
                priority: document.getElementById('priority').value,
                subject: document.getElementById('subject').value,
                content: document.getElementById('content').value
            };

            clearLog();
            addLog(1, 'üì¶', `Bulk notification to ${request.userIds.length} users`);

            try {
                const response = await fetch('/api/v1/notifications/bulk', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(request)
                });
                const data = await response.json();
                showOutput('responseOutput', 'responseJson', data);
                addLog(1, '‚úÖ', `Bulk request processed`, 'success');
            } catch (error) {
                addLog(1, '‚ùå', `Error: ${error.message}`, 'error');
            }
        }

        // ============ STEP 4-6: Track Notification ============
        async function trackNotification() {
            const id = document.getElementById('trackNotificationId').value;
            if (!id) {
                alert('Please enter a notification ID');
                return;
            }

            try {
                const response = await fetch(`/api/v1/notifications/${id}`);
                const data = await response.json();
                showOutput('trackingOutput', 'trackingJson', data);

                if (data.data?.status) {
                    const status = data.data.status;
                    if (status === 'SENT' || status === 'DELIVERED') {
                        updatePipeline(7, true);
                    } else if (status === 'PROCESSING') {
                        updatePipeline(5);
                    } else if (status === 'PENDING') {
                        updatePipeline(3);
                    }
                }
            } catch (error) {
                alert('Error tracking notification: ' + error.message);
            }
        }

        async function refreshNotificationStatus() {
            await trackNotification();
        }

        // ============ STEP 7: User Inbox ============
        async function getUserInbox() {
            const userId = document.getElementById('inboxUserId').value;
            if (!userId) {
                alert('Please enter a user ID');
                return;
            }

            try {
                const response = await fetch(`/api/v1/notifications/user/${userId}`);
                const data = await response.json();
                
                document.getElementById('inboxOutput').classList.remove('hidden');
                
                if (data.data?.content && data.data.content.length > 0) {
                    let html = '<div class="notification-list">';
                    data.data.content.forEach(n => {
                        const channelIcon = {EMAIL: 'üìß', SMS: 'üì±', PUSH: 'üîî', IN_APP: 'üì¨'}[n.channel] || 'üì®';
                        html += `
                            <div class="notification-item">
                                <div class="header-row">
                                    <span><span class="channel-icon">${channelIcon}</span> ${n.subject || 'No subject'}</span>
                                    <span class="status-badge status-${n.status?.toLowerCase()}">${n.status}</span>
                                </div>
                                <div class="content-preview">${n.content?.substring(0,100)}...</div>
                                <div style="font-size:0.8em; color:#666; margin-top:5px;">
                                    ID: ${n.id?.substring(0,8)}... | ${new Date(n.createdAt).toLocaleString()}
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    document.getElementById('inboxContent').innerHTML = html;
                } else {
                    document.getElementById('inboxContent').innerHTML = '<div class="json-output">' + formatJson(data) + '</div>';
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function getUnreadCount() {
            const userId = document.getElementById('inboxUserId').value;
            if (!userId) return;

            try {
                const response = await fetch(`/api/v1/notifications/user/${userId}/unread-count`);
                const data = await response.json();
                document.getElementById('inboxOutput').classList.remove('hidden');
                document.getElementById('inboxContent').innerHTML = `
                    <div style="text-align:center; padding:20px;">
                        <div style="font-size:3em; color:#667eea;">${data.data || 0}</div>
                        <div style="color:#888;">Unread Notifications</div>
                    </div>
                `;
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function markAllRead() {
            const userId = document.getElementById('inboxUserId').value;
            if (!userId) return;

            try {
                const response = await fetch(`/api/v1/notifications/user/${userId}/read-all`, { method: 'PATCH' });
                const data = await response.json();
                alert('All notifications marked as read!');
                getUserInbox();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // ============ Templates ============
        async function createTemplate() {
            const request = {
                name: document.getElementById('newTemplateName').value,
                channel: document.getElementById('newTemplateChannel').value,
                subject: document.getElementById('newTemplateSubject').value,
                content: document.getElementById('newTemplateBody').value
            };

            try {
                const response = await fetch('/api/v1/templates', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(request)
                });
                const data = await response.json();
                showOutput('templateOutput', 'templateJson', data);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function loadTemplates() {
            try {
                const response = await fetch('/api/v1/templates');
                const data = await response.json();
                showOutput('templateOutput', 'templateJson', data);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function loadTemplatesByChannel(channel) {
            try {
                const response = await fetch(`/api/v1/templates?channel=${channel}`);
                const data = await response.json();
                showOutput('templateOutput', 'templateJson', data);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // ============ Users ============
        async function findUserByEmail() {
            const email = document.getElementById('lookupEmail').value;
            if (!email) return;

            try {
                const response = await fetch(`/api/v1/users/email/${encodeURIComponent(email)}`);
                const data = await response.json();
                showOutput('userOutput', 'userJson', data);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function findUserByPhone() {
            const phone = document.getElementById('lookupPhone').value;
            if (!phone) return;

            try {
                const response = await fetch(`/api/v1/users/phone/${encodeURIComponent(phone)}`);
                const data = await response.json();
                showOutput('userOutput', 'userJson', data);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function getPushEligibleUsers() {
            try {
                const response = await fetch('/api/v1/users/push-eligible');
                const data = await response.json();
                showOutput('userOutput', 'userJson', data);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function getAllUsers() {
            try {
                const response = await fetch('/api/v1/users');
                const data = await response.json();
                showOutput('userOutput', 'userJson', data);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function createUser() {
            const email = document.getElementById('createUserEmail').value;
            const phone = document.getElementById('createUserPhone').value;
            const deviceToken = document.getElementById('createUserDeviceToken').value;

            if (!email) {
                alert('Email is required');
                return;
            }

            try {
                const response = await fetch('/api/v1/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: email,
                        phone: phone || null,
                        deviceToken: deviceToken || null
                    })
                });
                const data = await response.json();
                showOutput('userOutput', 'userJson', data);

                // Clear form on success
                if (response.ok) {
                    document.getElementById('createUserEmail').value = '';
                    document.getElementById('createUserPhone').value = '';
                    document.getElementById('createUserDeviceToken').value = '';
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // ============ Additional User Management Functions ============
        async function findUserById() {
            const userId = document.getElementById('lookupUserId').value;
            if (!userId) {
                alert('Please enter a User ID');
                return;
            }

            try {
                const response = await fetch(`/api/v1/users/${userId}`);
                const data = await response.json();
                showOutput('userOutput', 'userJson', data);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function getUserNotificationHistory() {
            const userId = document.getElementById('operationUserId').value;
            if (!userId) {
                alert('Please enter a User ID');
                return;
            }

            try {
                const response = await fetch(`/api/v1/notifications/user/${userId}`);
                const data = await response.json();
                showOutput('userOutput', 'userJson', data);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function getUnreadCount() {
            const userId = document.getElementById('operationUserId').value;
            if (!userId) {
                alert('Please enter a User ID');
                return;
            }

            try {
                const response = await fetch(`/api/v1/notifications/user/${userId}/unread-count`);
                const data = await response.json();
                showOutput('userOutput', 'userJson', data);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function markAllAsRead() {
            const userId = document.getElementById('operationUserId').value;
            if (!userId) {
                alert('Please enter a User ID');
                return;
            }

            try {
                const response = await fetch(`/api/v1/notifications/user/${userId}/read-all`, {
                    method: 'PATCH'
                });
                const data = await response.json();
                showOutput('userOutput', 'userJson', data);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function getUsersWithUnreadNotifications() {
            try {
                // This would need a backend endpoint - for now, we'll show all users
                // In a real implementation, you'd have an endpoint like /api/v1/users/with-unread
                const response = await fetch('/api/v1/users');
                const data = await response.json();
                showOutput('userOutput', 'userJson', data);
                alert('Note: This shows all users. A dedicated endpoint for users with unread notifications would be needed.');
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function updateUser() {
            const userId = document.getElementById('updateUserId').value;
            const email = document.getElementById('updateUserEmail').value;
            const phone = document.getElementById('updateUserPhone').value;
            const deviceToken = document.getElementById('updateUserDeviceToken').value;

            if (!userId) {
                alert('User ID is required');
                return;
            }

            const updateData = {};
            if (email) updateData.email = email;
            if (phone) updateData.phone = phone;
            if (deviceToken) updateData.deviceToken = deviceToken;

            if (Object.keys(updateData).length === 0) {
                alert('Please provide at least one field to update');
                return;
            }

            try {
                const response = await fetch(`/api/v1/users/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updateData)
                });
                const data = await response.json();
                showOutput('userOutput', 'userJson', data);

                // Clear form on success
                if (response.ok) {
                    document.getElementById('updateUserId').value = '';
                    document.getElementById('updateUserEmail').value = '';
                    document.getElementById('updateUserPhone').value = '';
                    document.getElementById('updateUserDeviceToken').value = '';
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function deleteUser() {
            const userId = document.getElementById('operationUserId').value;
            if (!userId) {
                alert('Please enter a User ID in the operations field');
                return;
            }

            if (!confirm(`Are you sure you want to delete user ${userId}? This action cannot be undone.`)) {
                return;
            }

            try {
                const response = await fetch(`/api/v1/users/${userId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                showOutput('userOutput', 'userJson', data);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // ============ Health ============
        async function checkHealth() {
            try {
                const response = await fetch('/api/v1/health');
                const data = await response.json();
                showOutput('healthOutput', 'healthJson', data);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function checkDetailedHealth() {
            try {
                const response = await fetch('/api/v1/health/detailed');
                const data = await response.json();
                
                document.getElementById('healthGrid').classList.remove('hidden');
                showOutput('healthOutput', 'healthJson', data);

                // Update health grid
                updateHealthItem('healthService', data.data?.status === 'UP');
                
                const deps = data.data?.dependencies || {};
                updateHealthItem('healthDatabase', deps.database?.status === 'UP');
                updateHealthItem('healthRedis', deps.redis?.status === 'UP');
                updateHealthItem('healthKafka', deps.kafka?.status === 'UP');

            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function updateHealthItem(id, isUp) {
            const item = document.getElementById(id);
            item.classList.remove('up', 'down');
            item.classList.add(isUp ? 'up' : 'down');
            item.querySelector('.status').textContent = isUp ? '‚úÖ UP' : '‚ùå DOWN';
        }

        // ============ All Topics Notifications Monitor ============
        async function loadAllNotifications() {
            try {
                const response = await fetch('/api/v1/notifications');
                const data = await response.json();
                
                // Handle paginated response structure
                let notifications = [];
                if (data.data && data.data.content) {
                    // Paginated response
                    notifications = data.data.content;
                } else if (Array.isArray(data.data)) {
                    // Direct array response
                    notifications = data.data;
                } else if (Array.isArray(data)) {
                    // Response is directly an array
                    notifications = data;
                }
                
                displayNotifications(notifications);
                document.getElementById('notificationsMonitorOutput').classList.remove('hidden');
            } catch (error) {
                alert('Error loading notifications: ' + error.message);
            }
        }

        async function loadNotificationsByUser() {
            const userId = document.getElementById('filterUserId').value;
            if (!userId) {
                alert('Please enter a User ID');
                return;
            }

            try {
                const response = await fetch(`/api/v1/notifications/user/${userId}`);
                const data = await response.json();
                
                // Handle different response structures
                let notifications = [];
                if (data.data && data.data.content) {
                    // Paginated response
                    notifications = data.data.content;
                } else if (Array.isArray(data.data)) {
                    // Direct array response
                    notifications = data.data;
                } else if (Array.isArray(data)) {
                    // Response is directly an array
                    notifications = data;
                }
                
                displayNotifications(notifications);
                document.getElementById('notificationsMonitorOutput').classList.remove('hidden');
            } catch (error) {
                alert('Error loading notifications: ' + error.message);
            }
        }

        function displayNotifications(notifications) {
            const container = document.getElementById('notificationsList');
            container.innerHTML = '';

            // Debug logging
            console.log('Displaying notifications:', notifications);

            // Ensure notifications is an array
            if (!Array.isArray(notifications)) {
                console.error('Notifications is not an array:', notifications);
                container.innerHTML = '<div style="text-align: center; color: #e74c3c; padding: 20px;">Error: Invalid notifications data format</div>';
                return;
            }

            if (notifications.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">No notifications found</div>';
                return;
            }

            notifications.forEach(notification => {
                const card = document.createElement('div');
                card.className = 'notification-card';

                const channelIcon = getChannelIcon(notification.channel);
                const statusClass = notification.status ? notification.status.toUpperCase() : 'PENDING';

                card.innerHTML = `
                    <div class="header">
                        <div style="display: flex; align-items: center;">
                            <span class="channel-badge ${notification.channel}">${channelIcon} ${notification.channel}</span>
                        </div>
                        <div class="status-badge ${statusClass}">${notification.status || 'PENDING'}</div>
                    </div>
                    <div class="content">${notification.content || notification.message || 'No content'}</div>
                    <div class="meta">
                        <span><strong>ID:</strong> ${notification.id}</span>
                        <span><strong>User:</strong> ${notification.userId}</span>
                        <span><strong>Priority:</strong> ${notification.priority || 'NORMAL'}</span>
                        <span><strong>Created:</strong> ${new Date(notification.createdAt).toLocaleString()}</span>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        function getChannelIcon(channel) {
            switch (channel) {
                case 'EMAIL': return 'üìß';
                case 'SMS': return 'üì±';
                case 'PUSH': return 'üîî';
                case 'IN_APP': return 'üí¨';
                default: return 'üì®';
            }
        }

        function clearNotifications() {
            document.getElementById('notificationsList').innerHTML = '';
            document.getElementById('notificationsMonitorOutput').classList.add('hidden');
        }
    </script>
</body>
</html>
